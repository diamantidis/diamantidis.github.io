<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"><title>Flutter: Two-way communication between a WebView and a web page</title><!-- Begin Jekyll SEO tag v2.8.0 --> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Flutter: Two-way communication between a WebView and a web page" /> <meta name="author" content="Ioannis Diamantidis" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A post about how to communicate between a WebView in Flutter and the website" /> <meta property="og:description" content="A post about how to communicate between a WebView in Flutter and the website" /> <link rel="canonical" href="https://diamantidis.github.io/2021/10/17/two-way-communication-between-flutter-webview-and-a-web-page" /> <meta property="og:url" content="https://diamantidis.github.io/2021/10/17/two-way-communication-between-flutter-webview-and-a-web-page" /> <meta property="og:site_name" content="Ioannis Diamantidis" /> <meta property="og:image" content="https://diamantidis.github.io/assets/social/flutter_webview.png" /> <meta property="og:image:height" content="512" /> <meta property="og:image:width" content="768" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-10-17T08:00:00+00:00" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://diamantidis.github.io/assets/social/flutter_webview.png" /> <meta property="twitter:title" content="Flutter: Two-way communication between a WebView and a web page" /> <meta name="twitter:site" content="@diamantidis_io" /> <meta name="twitter:creator" content="@diamantidis_io" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ioannis Diamantidis","url":"https://diamantidis.github.io"},"dateModified":"2021-10-17T08:00:00+00:00","datePublished":"2021-10-17T08:00:00+00:00","description":"A post about how to communicate between a WebView in Flutter and the website","headline":"Flutter: Two-way communication between a WebView and a web page","image":{"width":768,"height":512,"url":"https://diamantidis.github.io/assets/social/flutter_webview.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diamantidis.github.io/2021/10/17/two-way-communication-between-flutter-webview-and-a-web-page"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://diamantidis.github.io/assets/socialIcon.png"},"name":"Ioannis Diamantidis"},"url":"https://diamantidis.github.io/2021/10/17/two-way-communication-between-flutter-webview-and-a-web-page"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/assets/main.css"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.png"/> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"> <link rel="manifest" href="/assets/site.webmanifest"> <link rel="mask-icon" href="assets/safari-pinned-tab.svg" color="#5bbad5"> <link rel="shortcut icon" href="/assets/favicon.ico"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/browserconfig.xml"> <meta name="theme-color" content="#ffffff"><!-- Buy me a coffee widget --> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="diamantidis" data-description="Support me on Buy me a coffee!" data-message="" data-color="#347ab7" data-position="Right" data-x_margin="18" data-y_margin="18"></script> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://diamantidis.github.io/feed.xml" title="Ioannis Diamantidis" /><script src="https://cdn.telemetrydeck.com/websdk/telemetrydeck.min.js" data-app-id='38585865-E115-4830-8D37-7A8F1213DC6B' ></script> <script> !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]); posthog.init('phc_sTVQpj2y4ME7gaB3ETrOfwqd4B78MrA2ixW11xju0Hg',{api_host:'https://eu.posthog.com'}) </script></head> <body><header class="site-header" role="banner"> <div class="wrapper"><div class="left-container"> <div class="title-wrapper"> <a class="site-title" rel="author" href="/"> <h1>Ioannis Diamantidis</h1> </a> </div> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> </div><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" /> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/tips" title="Tips">Tips</a><a class="page-link" href="/about" title="About">About</a><a class="page-link" href="/archive" title="Archive">Archive</a><a class="page-link" href="/tags" title="Tags">Tags</a></div> </nav></div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="post"> <header class="post-header"> <h1> <span class="post-title break-long-word">Flutter: Two-way communication between a WebView and a web page</span> </h1> <div class="post-subheader"> <span class="post-date"> October 17, 2021 </span> <span class="post-divider">-</span> <span class="post-minutes"> 7 min read </span> <div class="outer-post-tags"> <div class="post-tags"> <a class="post-tag" href="/tags#Flutter" title="Flutter">Flutter</a> </div> </div> </div> </header> <div class="post-content"> <p>Displaying web content in an app is quite easy and straightforward with WebViews but what happens when we want to open a communication channel between the app and the web page we load on a WebView?</p> <p>Let’s say, for example, you want to “listen” to a button click event happening on the web page and take some action in the app. Or you want to update a label of a web page with some data from the app.</p> <p>In this post, I will show you how you can communicate between the app and the web page of a WebView.</p> <p>In order to do so, I am going to use an example to demonstrate how to achieve this communication in both directions; both from the web page to the app and from the app to the web page.</p> <p>Let’s get started!</p> <blockquote> <p>This post is based on <code class="language-plaintext highlighter-rouge">Flutter 2.5.2</code> and <code class="language-plaintext highlighter-rouge">Dart SDK 2.14.3</code></p> </blockquote> <h2 id="implementation">Implementation</h2> <h3 id="the-package">The package</h3> <p>Flutter doesn’t have built in support for WebViews. As a result, we are going to use a package with name <a href="https://pub.dev/packages/webview_flutter">webview_flutter</a>.</p> <p>So first thing first is to edit <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> and add the dependency:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">flutter</span><span class="pi">:</span>
    <span class="na">sdk</span><span class="pi">:</span> <span class="s">flutter</span>
  <span class="na">webview_flutter</span><span class="pi">:</span> <span class="s">^2.1.1</span>
</code></pre></div></div> <h3 id="the-html-file">The HTML file</h3> <p>Next, we are going to create the web page that we will later load in the WebView.</p> <p>For the sake of this article and for ease, we are going to create an <code class="language-plaintext highlighter-rouge">index.html</code> file which we are going to load in the webview instead of loading a webpage from a URL.</p> <p>Let’s create an HTML file named <code class="language-plaintext highlighter-rouge">index.html</code> inside the <code class="language-plaintext highlighter-rouge">assets</code> folder (if the folder doesn’t exist, feel free to create one).</p> <p>Then, we will open this file and add the following content:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;style&gt;</span>
            <span class="nc">.switch</span> <span class="p">{</span> <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span> <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span> <span class="nl">width</span><span class="p">:</span> <span class="m">60px</span><span class="p">;</span> <span class="nl">height</span><span class="p">:</span> <span class="m">34px</span><span class="p">;</span> <span class="p">}</span>
            <span class="nc">.switch</span> <span class="nt">input</span> <span class="p">{</span> <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">width</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">height</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span>
            <span class="nt">label</span><span class="nc">.switch</span> <span class="p">{</span> <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span> <span class="p">}</span>
            <span class="nc">.slider</span> <span class="p">{</span> <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span> <span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span> <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#ccc</span><span class="p">;</span> <span class="nl">-webkit-transition</span><span class="p">:</span> <span class="m">.4s</span><span class="p">;</span> <span class="nl">transition</span><span class="p">:</span> <span class="m">.4s</span><span class="p">;</span> <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span> <span class="p">}</span>
            <span class="nc">.slider</span><span class="nd">:before</span> <span class="p">{</span> <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span> <span class="nl">content</span><span class="p">:</span> <span class="s1">""</span><span class="p">;</span> <span class="nl">height</span><span class="p">:</span> <span class="m">26px</span><span class="p">;</span> <span class="nl">width</span><span class="p">:</span> <span class="m">26px</span><span class="p">;</span> <span class="nl">left</span><span class="p">:</span> <span class="m">4px</span><span class="p">;</span> <span class="nl">bottom</span><span class="p">:</span> <span class="m">4px</span><span class="p">;</span> <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span> <span class="nl">-webkit-transition</span><span class="p">:</span> <span class="m">.4s</span><span class="p">;</span> <span class="nl">transition</span><span class="p">:</span> <span class="m">.4s</span><span class="p">;</span> <span class="p">}</span>
            <span class="nt">input</span><span class="nd">:checked</span> <span class="o">+</span> <span class="nc">.slider</span> <span class="p">{</span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#2196F3</span><span class="p">;</span> <span class="p">}</span>
            <span class="nt">input</span><span class="nd">:focus</span> <span class="o">+</span> <span class="nc">.slider</span> <span class="p">{</span> <span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1px</span> <span class="m">#2196F3</span><span class="p">;</span> <span class="p">}</span>
            <span class="nt">input</span><span class="nd">:checked</span> <span class="o">+</span> <span class="nc">.slider</span><span class="nd">:before</span> <span class="p">{</span> <span class="nl">-webkit-transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">26px</span><span class="p">);</span> <span class="nl">-ms-transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">26px</span><span class="p">);</span> <span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">26px</span><span class="p">);</span> <span class="p">}</span>
            <span class="nc">.slider.round</span> <span class="p">{</span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">34px</span><span class="p">;</span> <span class="p">}</span>
            <span class="nc">.slider.round</span><span class="nd">:before</span> <span class="p">{</span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span> <span class="p">}</span>
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"value"</span><span class="nt">&gt;</span>Toggle Switch is off<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"switch"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"myCheckbox"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"slider round"</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <blockquote> <p>For brevity reasons, the CSS part is minimized.</p> </blockquote> <p>This HTML file produces a web page with a label and a toggle switch. Our goal for this article is to listen to the toggle events from the app and update the text on the label to represent the corresponding state of the toggle switch.</p> <p>To be able to access this <code class="language-plaintext highlighter-rouge">html</code> file from our application, we have to edit <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> and add the following under the <code class="language-plaintext highlighter-rouge">flutter</code> section:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">flutter</span><span class="pi">:</span>

  <span class="na">assets</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">assets/index.html</span>
</code></pre></div></div> <h3 id="the-app">The app</h3> <p>Now, with all the preparations done, we can focus on the app!</p> <p>First of all, we will import the package:</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'package:webview_flutter/webview_flutter.dart'</span><span class="o">;</span>
</code></pre></div></div> <p>Then, we can create our webview like this:</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WebViewController</span><span class="o">?</span> <span class="n">_webViewController</span><span class="o">;</span>

<span class="n">Widget</span> <span class="nf">buildWebView</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">WebView</span><span class="o">(</span>
        <span class="nl">initialUrl:</span> <span class="s">'about:blank'</span><span class="o">,</span>
        <span class="nl">javascriptMode:</span> <span class="n">JavascriptMode</span><span class="o">.</span><span class="na">unrestricted</span><span class="o">,</span>
        <span class="nl">onWebViewCreated:</span> <span class="o">(</span><span class="n">WebViewController</span> <span class="n">webViewController</span><span class="o">)</span> <span class="n">async</span> <span class="o">{</span>
            <span class="n">_webViewController</span> <span class="o">=</span> <span class="n">webViewController</span><span class="o">;</span>
            <span class="kt">String</span> <span class="n">fileContent</span> <span class="o">=</span> <span class="n">await</span> <span class="n">rootBundle</span><span class="o">.</span><span class="na">loadString</span><span class="o">(</span><span class="s">'assets/index.html'</span><span class="o">);</span>
            <span class="n">_webViewController</span><span class="o">?.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">dataFromString</span><span class="o">(</span><span class="n">fileContent</span><span class="o">,</span> <span class="nl">mimeType:</span> <span class="s">'text/html'</span><span class="o">,</span> <span class="nl">encoding:</span> <span class="n">Encoding</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">'utf-8'</span><span class="o">)).</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">},</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>In this snippet, we added a function that will return a new <code class="language-plaintext highlighter-rouge">WebView</code> and we pass some parameters.</p> <p>Firstly, we will use <code class="language-plaintext highlighter-rouge">about:black</code> as the initial URL to load an empty page. Then, we will set <code class="language-plaintext highlighter-rouge">javascriptMode</code> to <code class="language-plaintext highlighter-rouge">unrestricted</code> to allow the execution of Javascript code, and lastly, when the web view is created, we will load the content of the <code class="language-plaintext highlighter-rouge">index.html</code> and load it to the web view.</p> <p>The only thing left is to call this function from the <code class="language-plaintext highlighter-rouge">Widget build(BuildContext context)</code>, add the required imports and run the app. If you do so, you will be able to see the page with the label and the toggle!</p> <p><img src="https://diamantidis.github.io/assets/fl_webview/toggle_off.jpeg" alt="WKWebView with a toggle screenshot" /></p> <h2 id="adding-a-message-handler">Adding a message handler</h2> <p>The next step is to enable our <code class="language-plaintext highlighter-rouge">WebView</code> to receive messages from the web page. For this, we will update the <code class="language-plaintext highlighter-rouge">WebView</code> we created before and add the <code class="language-plaintext highlighter-rouge">javascriptChannels:</code> parameter, like in the following snippet:</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Widget</span> <span class="nf">buildWebView</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">WebView</span><span class="o">(</span>
        <span class="o">.</span>
        <span class="o">.</span>
        <span class="o">.</span>
        <span class="nl">javascriptChannels:</span> <span class="o">&lt;</span><span class="n">JavascriptChannel</span><span class="o">&gt;{</span>
            <span class="n">JavascriptChannel</span><span class="o">(</span>
                <span class="nl">name:</span> <span class="s">'messageHandler'</span><span class="o">,</span>
                <span class="nl">onMessageReceived:</span> <span class="o">(</span><span class="n">JavascriptMessage</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">print</span><span class="o">(</span><span class="s">"message from the web view=</span><span class="se">\"</span><span class="si">${message.message}</span><span class="se">\"</span><span class="s">"</span><span class="o">);</span>
                <span class="o">},</span>
            <span class="o">)</span>
        <span class="o">},</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Here, we create a new <code class="language-plaintext highlighter-rouge">JavascriptChannel</code> with name <code class="language-plaintext highlighter-rouge">messageHandler</code> and provide a callback for when a message is received. For now, we just print the message.</p> <p>We are now ready to send our messages from the web page.</p> <p>Let’s see how!</p> <h3 id="sending-message-from-the-webpage">Sending message from the webpage</h3> <p>For this part, we are going to use some <code class="language-plaintext highlighter-rouge">JavaScript</code> to listen to the toggle events and then send a message to the app. This message will be different if the toggle is selected or not. Let’s edit our HTML file and before the closing <code class="language-plaintext highlighter-rouge">&lt;/body&gt;</code> tag, add the following content:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">var</span> <span class="nx">_selector</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name=myCheckbox]</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">_selector</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_selector</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Toggle Switch is on</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Toggle Switch is off</span><span class="dl">"</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">messageHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">messageHandler</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <p>In this script, we are adding an <code class="language-plaintext highlighter-rouge">eventListener</code> for the toggle change event, and depending on whether it is selected or not, we are using the <code class="language-plaintext highlighter-rouge">messageHandler</code> that we created previously, to call the function <code class="language-plaintext highlighter-rouge">postMessage</code>, which in turn will trigger the <code class="language-plaintext highlighter-rouge">onMessageReceived</code> of the <code class="language-plaintext highlighter-rouge">JavascriptChannel</code> with the name <code class="language-plaintext highlighter-rouge">messageHandler</code>.</p> <p>If you run the app and turn the toggle on and off, you will be able to see some messages on the console like <code class="language-plaintext highlighter-rouge">message from the web view="Toggle Switch is on"</code>.</p> <p>The last thing to achieve our goal is to update the label of the web page when we change the value of the toggle.</p> <h3 id="evaluating-javascript-to-update-webpages-ui">Evaluating JavaScript to update webpage’s UI</h3> <p><code class="language-plaintext highlighter-rouge">WebViewController</code> has a function with name <code class="language-plaintext highlighter-rouge">evaluateJavascript</code> and this is what we are going to use to update the UI.</p> <p>Head over to the definition of the <code class="language-plaintext highlighter-rouge">JavascriptChannel</code> and instead of the <code class="language-plaintext highlighter-rouge">print</code> command on the <code class="language-plaintext highlighter-rouge">onMessageReceived</code> callback, add the following snippet:</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="n">script</span> <span class="o">=</span> <span class="s">"document.getElementById('value').innerText=</span><span class="se">\"</span><span class="si">${message.message}</span><span class="se">\"</span><span class="s">"</span><span class="o">;</span>
<span class="n">_webViewController</span><span class="o">?.</span><span class="na">evaluateJavascript</span><span class="o">(</span><span class="n">script</span><span class="o">);</span>
</code></pre></div></div> <p>In this snippet, we are creating a variable with the JavaScript code to change the label on the web page, and then use the <code class="language-plaintext highlighter-rouge">evaluateJavaScript</code> to execute this code.</p> <p>And that’s about it, if you now run the app, the text of the label will change when the toggle is switched on or off.</p> <p><img src="https://diamantidis.github.io/assets/fl_webview/toggle_animation.gif" alt="WebView with toggle on and off screenshot" /></p> <h2 id="conclusion">Conclusion</h2> <p>In this post, we have seen how to achieve bidirectional communication between a WebView and a web page. Using this, we can use events from the website to trigger actions on the app and similarly adjust the content of the loaded website based on the information we have on the app.</p> <p>I hope that you find this post useful and if you have any questions or comments about this post, feel free to reach out to me on <a href="https://twitter.com/diamantidis_io">Twitter</a>!</p> <p>Until next time!</p> </div> <div class="socials"> <!-- Buy me a coffee button --> <a href="https://www.buymeacoffee.com/diamantidis" target="_blank"> <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" > </a> <div class="share"> <strong>Share: </strong> <a href="//twitter.com/share?text=Flutter%3A+Two-way+communication+between+a+WebView+and+a+web+page&url=https%3A%2F%2Fdiamantidis.github.io%2F2021%2F10%2F17%2Ftwo-way-communication-between-flutter-webview-and-a-web-page" aria-label="Share on Twitter" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.facebook.com/sharer.php?t=Flutter%3A+Two-way+communication+between+a+WebView+and+a+web+page&u=https%3A%2F%2Fdiamantidis.github.io%2F2021%2F10%2F17%2Ftwo-way-communication-between-flutter-webview-and-a-web-page" aria-label="Share on Facebook" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdiamantidis.github.io%2F2021%2F10%2F17%2Ftwo-way-communication-between-flutter-webview-and-a-web-page" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </div></article> </div> </main><footer class="site-footer"> <data class="u-url" href="/"></data> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> <div class="wrapper"> <p>Built with <i class="fa fa-heart" aria-hidden="true"></i>, <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/"> Github Pages</a> </p> <p> © Copyright 2024 Ioannis Diamantidis </p> </div> </footer></body> </html>
