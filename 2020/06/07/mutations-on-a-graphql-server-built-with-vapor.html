<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"><title>Mutations on a GraphQL server built with Vapor</title><!-- Begin Jekyll SEO tag v2.8.0 --> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Mutations on a GraphQL server built with Vapor" /> <meta name="author" content="Ioannis Diamantidis" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A post describing how to add mutations to create, edit and delete entries on a GraphQL server built with Vapor" /> <meta property="og:description" content="A post describing how to add mutations to create, edit and delete entries on a GraphQL server built with Vapor" /> <link rel="canonical" href="https://diamantidis.github.io/2020/06/07/mutations-on-a-graphql-server-built-with-vapor" /> <meta property="og:url" content="https://diamantidis.github.io/2020/06/07/mutations-on-a-graphql-server-built-with-vapor" /> <meta property="og:site_name" content="Ioannis Diamantidis" /> <meta property="og:image" content="https://diamantidis.github.io/assets/social/mutations-on-a-graphql-server-built-with-vapor.png" /> <meta property="og:image:height" content="512" /> <meta property="og:image:width" content="828" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-06-07T04:00:00+00:00" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://diamantidis.github.io/assets/social/mutations-on-a-graphql-server-built-with-vapor.png" /> <meta property="twitter:title" content="Mutations on a GraphQL server built with Vapor" /> <meta name="twitter:site" content="@diamantidis_io" /> <meta name="twitter:creator" content="@diamantidis_io" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ioannis Diamantidis","url":"https://diamantidis.github.io"},"dateModified":"2020-06-07T04:00:00+00:00","datePublished":"2020-06-07T04:00:00+00:00","description":"A post describing how to add mutations to create, edit and delete entries on a GraphQL server built with Vapor","headline":"Mutations on a GraphQL server built with Vapor","image":{"width":828,"height":512,"url":"https://diamantidis.github.io/assets/social/mutations-on-a-graphql-server-built-with-vapor.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diamantidis.github.io/2020/06/07/mutations-on-a-graphql-server-built-with-vapor"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://diamantidis.github.io/assets/socialIcon.png"},"name":"Ioannis Diamantidis"},"url":"https://diamantidis.github.io/2020/06/07/mutations-on-a-graphql-server-built-with-vapor"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/assets/main.css"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.png"/> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"> <link rel="manifest" href="/assets/site.webmanifest"> <link rel="mask-icon" href="assets/safari-pinned-tab.svg" color="#5bbad5"> <link rel="shortcut icon" href="/assets/favicon.ico"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/browserconfig.xml"> <meta name="theme-color" content="#ffffff"><!-- Buy me a coffee widget --> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="diamantidis" data-description="Support me on Buy me a coffee!" data-message="" data-color="#347ab7" data-position="Right" data-x_margin="18" data-y_margin="18"></script> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://diamantidis.github.io/feed.xml" title="Ioannis Diamantidis" /><script src="https://cdn.telemetrydeck.com/websdk/telemetrydeck.min.js" data-app-id='38585865-E115-4830-8D37-7A8F1213DC6B' ></script> <script> !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]); posthog.init('phc_sTVQpj2y4ME7gaB3ETrOfwqd4B78MrA2ixW11xju0Hg',{api_host:'https://eu.posthog.com'}) </script></head> <body><header class="site-header" role="banner"> <div class="wrapper"><div class="left-container"> <div class="title-wrapper"> <a class="site-title" rel="author" href="/"> <h1>Ioannis Diamantidis</h1> </a> </div> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> </div><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" /> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/tips" title="Tips">Tips</a><a class="page-link" href="/about" title="About">About</a><a class="page-link" href="/archive" title="Archive">Archive</a><a class="page-link" href="/tags" title="Tags">Tags</a></div> </nav></div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="post"> <header class="post-header"> <h1> <span class="post-title break-long-word">Mutations on a GraphQL server built with Vapor</span> </h1> <div class="post-subheader"> <span class="post-date"> June 7, 2020 </span> <span class="post-divider">-</span> <span class="post-minutes"> 10 min read </span> <div class="outer-post-tags"> <div class="post-tags"> <a class="post-tag" href="/tags#Swift" title="Swift">Swift</a> <a class="post-tag" href="/tags#Vapor" title="Vapor">Vapor</a> <a class="post-tag" href="/tags#GraphQL" title="GraphQL">GraphQL</a> </div> </div> </div> </header> <div class="post-content"> <p>One characteristic of a complete API is its ability to allow clients to modify the server-side data. This can be in the form of creating new entries, updating or deleting existing ones, etc. Building a GraphQL server couldn’t be any different.</p> <p>To describe this kind of features, GraphQL uses the term <code class="language-plaintext highlighter-rouge">Mutations</code>. Mutations are just like normal queries. The only difference is that they make it explicit that they will result in some kind of side-effect on the server-side data.</p> <p>And that’s where this post will focus on. I am going to describe how to add the mutations to create, edit, and delete an entry on a GraphQL server built with Vapor.</p> <h2 id="prerequisites">Prerequisites</h2> <p>The code in this post is a continuation of the code from my two latest posts. In the first one, I described <a href="/2020/05/24/swift-loves-graphql-server-with-vapor-and-ios-app-client">how to setup a GraphQL server with Vapor</a> and in the second I focused on <a href="/2020/05/31/custom-graphql-types-on-swift-projects">how to use custom types on this GraphQL server</a>.</p> <p>If you want to go through the code as you read the post, the code from the previous posts as well as the code from this post is available on <a href="https://github.com/diamantidis/vapor-graphql/tree/3db78ea">GitHub</a>.</p> <p>Now, let’s get started!</p> <h2 id="implementation">Implementation</h2> <h3 id="prepare-the-models">Prepare the models</h3> <p>First, and before we jump into the mutations, we need to adjust our existing models to support the mutations.</p> <p>For example, when it comes to the edit mutation, we will have to update some properties of the <code class="language-plaintext highlighter-rouge">Post</code> model from constant to variable properties.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> struct Post: Codable {
     let id: CustomUUID
<span class="gd">-    let title: String
</span><span class="gi">+    var title: String
</span>     let publishedAt: Date
<span class="gd">-    let tags: [Tag]
</span><span class="gi">+    var tags: [Tag]
</span>     let author: Author
 }
</code></pre></div></div> <p>Similarly, in order to be able to filter the posts by the <code class="language-plaintext highlighter-rouge">id</code> property, we will have to make <code class="language-plaintext highlighter-rouge">CustomUUID</code> conform to the <code class="language-plaintext highlighter-rouge">Equatable</code> protocol.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-struct CustomUUID: Codable {
</span><span class="gi">+struct CustomUUID: Codable, Equatable {
</span></code></pre></div></div> <p>With our models ready, we can now move on and start adding the logic for the mutations!</p> <h2 id="delete-mutation">Delete mutation</h2> <p>Let’s start with the logic for the <code class="language-plaintext highlighter-rouge">deletePost</code> mutation. For this mutation, we will expect the <code class="language-plaintext highlighter-rouge">id</code> of the <code class="language-plaintext highlighter-rouge">Post</code> to delete as an argument. Then, using this <code class="language-plaintext highlighter-rouge">id</code>, we will search for the <code class="language-plaintext highlighter-rouge">Post</code> in the in-memory list. If we manage to find the post, we are going to remove it and return <code class="language-plaintext highlighter-rouge">true</code> to the client. Otherwise, we will return <code class="language-plaintext highlighter-rouge">false</code> to let the client know that we didn’t manage to find the <code class="language-plaintext highlighter-rouge">Post</code>.</p> <blockquote> <p>For the sake of this post, I am using a <code class="language-plaintext highlighter-rouge">Bool</code> as a return type. Ideally, we should return an error Type, but to keep this post focused on the mutations, I decided to go with the <code class="language-plaintext highlighter-rouge">Bool</code>.</p> </blockquote> <p>So, let’s add an extension to the <code class="language-plaintext highlighter-rouge">PostController</code> with this logic.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">PostController</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="kt">DeletePostArguments</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">CustomUUID</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">deletePost</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">Request</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="kt">DeletePostArguments</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">postIndex</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="n">firstIndex</span><span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">arguments</span><span class="o">.</span><span class="n">id</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="n">postIndex</span><span class="p">?</span><span class="o">.</span><span class="n">indexValue</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="n">posts</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Similarly, let’s add the logic for the <code class="language-plaintext highlighter-rouge">editPost</code> mutation!</p> <h2 id="edit-mutation">Edit mutation</h2> <p>The edit mutation will allow the user to change the value of the title and the tags for a given post. As a result, this time, we are going to require three arguments; an <code class="language-plaintext highlighter-rouge">id</code>, which we will use to find the <code class="language-plaintext highlighter-rouge">Post</code> to edit, as well as a <code class="language-plaintext highlighter-rouge">title</code> and a <code class="language-plaintext highlighter-rouge">tags</code> argument, which will contain the updated values for the <code class="language-plaintext highlighter-rouge">title</code> and <code class="language-plaintext highlighter-rouge">tags</code> properties respectively.</p> <p>To keep the logic visually separated, let’s add a new extension to <code class="language-plaintext highlighter-rouge">PostController</code> for the logic related to the edit mutation. This extension will contain a new structure named <code class="language-plaintext highlighter-rouge">EditPostArguments</code> and a function <code class="language-plaintext highlighter-rouge">editPost</code> which will be responsible for editing a post.</p> <p>The implementation will look like the following snippet:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">PostController</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="kt">EditPostArguments</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">CustomUUID</span>
        <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">tags</span><span class="p">:</span> <span class="p">[</span><span class="kt">Tag</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">editPost</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">Request</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="kt">EditPostArguments</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Post</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">postIndex</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="n">firstIndex</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">arguments</span><span class="o">.</span><span class="n">id</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="n">postIndex</span><span class="p">?</span><span class="o">.</span><span class="n">indexValue</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>

        <span class="n">posts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">title</span>
        <span class="n">posts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">tags</span>
        <span class="k">return</span> <span class="n">posts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">EditPostArguments</code> structure has the three properties that we mentioned before. Then, the <code class="language-plaintext highlighter-rouge">editPost</code> function will accept those arguments as a parameter and will use the <code class="language-plaintext highlighter-rouge">id</code> to search for the <code class="language-plaintext highlighter-rouge">Post</code>. If we can’t find it, we will return <code class="language-plaintext highlighter-rouge">nil</code> to the client. If we manage to find it, we will update the properties of the <code class="language-plaintext highlighter-rouge">Post</code> with the values on the arguments and return the updated post to the client.</p> <p>Last but not least, let’s see how we can add the functionality to create a new post entity!</p> <h2 id="create-mutation">Create mutation</h2> <p>To create a new <code class="language-plaintext highlighter-rouge">Post</code> we would need a title, a set of tags, and the id of the author.</p> <p>It’s time to introduce a new GraphQL concept, the inputs. GraphQL distinguishes the types that can be used as input from those that can be used as outputs to queries. For example, in <a href="/2020/05/31/custom-graphql-types-on-swift-projects">a previous post</a>, I have used the type <code class="language-plaintext highlighter-rouge">Author</code> to return the author’s data. This is a typical example of an Output type. This kind of types, though, cannot be used when we want to pass arguments, be it in a query or a mutation. In order to define complex types for arguments, there is the concept of <code class="language-plaintext highlighter-rouge">Input</code>. <code class="language-plaintext highlighter-rouge">Input</code> is just like a type, with the only difference being the purpose of use and that it can only include scalar, enums, strings, int, float, bool, and other input types. We can not use an <code class="language-plaintext highlighter-rouge">Output</code> type as a field on an <code class="language-plaintext highlighter-rouge">Input</code> type.</p> <p>So, let’s create a <code class="language-plaintext highlighter-rouge">PostInput</code> type and add the properties that we need to create a new <code class="language-plaintext highlighter-rouge">Post</code>.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">PostInput</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">tags</span><span class="p">:</span> <span class="p">[</span><span class="kt">Tag</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">authorId</span><span class="p">:</span> <span class="kt">CustomUUID</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now, we can define the function to create a new <code class="language-plaintext highlighter-rouge">Post</code> on an extension of the <code class="language-plaintext highlighter-rouge">PostController</code>.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">PostController</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="kt">CreatePostArguments</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">input</span><span class="p">:</span> <span class="kt">PostInput</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">createPost</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">Request</span><span class="p">,</span> <span class="nv">arguments</span><span class="p">:</span> <span class="kt">CreatePostArguments</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Post</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">arguments</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">authorId</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">post</span> <span class="o">=</span> <span class="kt">Post</span><span class="p">(</span>
            <span class="nv">id</span><span class="p">:</span> <span class="kt">CustomUUID</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">()),</span>
            <span class="nv">title</span><span class="p">:</span> <span class="n">arguments</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="nv">publishedAt</span><span class="p">:</span> <span class="kt">Date</span><span class="p">(),</span>
            <span class="nv">tags</span><span class="p">:</span> <span class="n">arguments</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
            <span class="nv">author</span><span class="p">:</span> <span class="n">author</span>
        <span class="p">)</span>
        <span class="n">posts</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">post</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>In the same way as for the other functions, we define a structure for the type of the arguments. This structure contains a sole field of the type <code class="language-plaintext highlighter-rouge">PostInput</code> that we defined earlier. Then the function <code class="language-plaintext highlighter-rouge">createPost</code> takes an instance of this <code class="language-plaintext highlighter-rouge">CreatePostArguments</code> structure and uses it to create a new <code class="language-plaintext highlighter-rouge">Post</code> entity, which we later append to the list of existing posts.</p> <p>And that’s about it for the logic part of our mutations. Now, it’s time to integrate them into the GraphQL server.</p> <h2 id="graphql">GraphQL</h2> <p>To make those functions and arguments available on the GraphQL schema, we will have to update the <code class="language-plaintext highlighter-rouge">FieldKeyProvider</code> extension of the <code class="language-plaintext highlighter-rouge">PostController</code> and add the keys for them. We will use those keys to map the function and the arguments of <code class="language-plaintext highlighter-rouge">PostController</code> to the mutations and the arguments of the GraphQL schema.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    enum FieldKeys: String {
<span class="gi">+       case id
+       case title
+       case tags
+       case input
+
</span>        case posts
<span class="gi">+       case deletePost
+       case editPost
+       case createPost
</span>    }
</code></pre></div></div> <p>We will also provide conformance to the <code class="language-plaintext highlighter-rouge">FieldKeyProvider</code> protocol and define keys for the <code class="language-plaintext highlighter-rouge">PostInput</code> structure.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">PostInput</span><span class="p">:</span> <span class="kt">FieldKeyProvider</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">FieldKey</span> <span class="o">=</span> <span class="kt">FieldKeys</span>

    <span class="kd">enum</span> <span class="kt">FieldKeys</span> <span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">title</span>
        <span class="k">case</span> <span class="n">tags</span>
        <span class="k">case</span> <span class="n">authorId</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Lastly, we will update the GraphQL schema definition on <code class="language-plaintext highlighter-rouge">Schema.swift</code> by adding the definition for the <code class="language-plaintext highlighter-rouge">PostInput</code> input type and the definitions for the mutations using the keys we defined on the <code class="language-plaintext highlighter-rouge">FieldKeyProvider</code> extensions.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        Query([
            Field(.posts, at: PostController.fetchPosts),
        ]),
<span class="gi">+
+       Input(PostInput.self, [
+           InputField(.title, at: \.title),
+           InputField(.tags, at: \.tags),
+           InputField(.authorId, at: \.authorId)
+       ]),
+
+       Mutation([
+           Field(.deletePost, at: PostController.deletePost)
+               .argument(.id, at: \.id),
+
+           Field(.editPost, at: PostController.editPost)
+               .argument(.id, at: \.id)
+               .argument(.title, at: \.title)
+               .argument(.tags, at: \.tags),
+
+           Field(.createPost, at: PostController.createPost)
+               .argument(.input, at: \.input)
+       ])
+   ])
</span></code></pre></div></div> <p>And that’s all folks! We can now build and run the vapor server!</p> <h2 id="how-to-test">How to test?</h2> <p>To verify what we have done so far, we are going to use a tool named <a href="https://github.com/prisma-labs/graphql-playground">GraphQL Playground</a>.</p> <p>The installation process is quite simple, you just have to run <code class="language-plaintext highlighter-rouge">brew cask install graphql-playground</code>. Then, you can use the Spotlight Search (<code class="language-plaintext highlighter-rouge">⌘</code> + <code class="language-plaintext highlighter-rouge">Space bar</code>) and open the application <code class="language-plaintext highlighter-rouge">GraphQL Playground</code>.</p> <p>Once GraphQL Playground is running, we could run the following query to fetch the available posts:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">query</span> <span class="nx">AllPosts</span> <span class="p">{</span>
  <span class="nx">posts</span> <span class="p">{</span>
    <span class="nx">id</span>
    <span class="nx">author</span> <span class="p">{</span>
        <span class="nx">id</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>From the response, we are going to keep the id of the author and we will use it to create a new post with the following query (replace <code class="language-plaintext highlighter-rouge">00000000-0000-0000-0000-000000000000</code> with the UUID from the response):</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mutation</span> <span class="nx">CreatePost</span> <span class="p">{</span>
  <span class="nx">createPost</span><span class="p">(</span><span class="nx">input</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">authorId</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">00000000-0000-0000-0000-000000000000</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="nx">tags</span><span class="p">:</span> <span class="p">[</span><span class="nx">Swift</span><span class="p">,</span> <span class="nx">Vapor</span><span class="p">]</span>
    <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A new post</span><span class="dl">"</span>
  <span class="p">})</span> <span class="p">{</span>
    <span class="nx">id</span>
    <span class="nx">title</span>
    <span class="nx">publishedAt</span>
    <span class="nx">tags</span>
    <span class="nx">author</span> <span class="p">{</span>
      <span class="nx">id</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This time, keep the id of the post from the response, and use it on the next query to edit the title and the tags of the post:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mutation</span> <span class="nx">EditPost</span> <span class="p">{</span>
  <span class="nx">editPost</span><span class="p">(</span>
    <span class="nx">id</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">00000000-0000-0000-0000-000000000000</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="nx">tags</span><span class="p">:</span> <span class="p">[</span><span class="nx">Swift</span><span class="p">,</span> <span class="nx">Vapor</span><span class="p">,</span> <span class="nx">GraphQL</span><span class="p">],</span> 
    <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A new post with an updated title</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">id</span>
    <span class="nx">title</span>
    <span class="nx">publishedAt</span>
    <span class="nx">tags</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Finally, we can delete the post that we have created using the id of the post from the previous query on the following query:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mutation</span> <span class="nx">DeletePost</span> <span class="p">{</span>
  <span class="nx">deletePost</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">00000000-0000-0000-0000-000000000000</span><span class="dl">"</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="conclusion">Conclusion</h2> <p>And that’s about it! In this post, we have seen how to add mutations to create, edit and delete a <code class="language-plaintext highlighter-rouge">Post</code> on a GraphQL server built with Vapor. We have also seen how to take advantage of GraphQL’s Inputs for arguments with complex types and how to use <a href="https://github.com/prisma-labs/graphql-playground">GraphQL Playground</a> to run our GraphQL queries.</p> <p>In the next post, I am going to continue this GraphQL &amp; Swift journey and I am going to investigate how to use the mutations that we defined in this post from an iOS app. So stay tuned and follow me on <a href="https://twitter.com/diamantidis_io">Twitter</a> should you want to get notified once the next post is published or you have a question or comment about this post.</p> <p>Thanks for reading this post, and see you next time!</p> </div> <div class="socials"> <!-- Buy me a coffee button --> <a href="https://www.buymeacoffee.com/diamantidis" target="_blank"> <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" > </a> <div class="share"> <strong>Share: </strong> <a href="//twitter.com/share?text=Mutations+on+a+GraphQL+server+built+with+Vapor&url=https%3A%2F%2Fdiamantidis.github.io%2F2020%2F06%2F07%2Fmutations-on-a-graphql-server-built-with-vapor" aria-label="Share on Twitter" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.facebook.com/sharer.php?t=Mutations+on+a+GraphQL+server+built+with+Vapor&u=https%3A%2F%2Fdiamantidis.github.io%2F2020%2F06%2F07%2Fmutations-on-a-graphql-server-built-with-vapor" aria-label="Share on Facebook" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdiamantidis.github.io%2F2020%2F06%2F07%2Fmutations-on-a-graphql-server-built-with-vapor" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </div></article> </div> </main><footer class="site-footer"> <data class="u-url" href="/"></data> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> <div class="wrapper"> <p>Built with <i class="fa fa-heart" aria-hidden="true"></i>, <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/"> Github Pages</a> </p> <p> © Copyright 2024 Ioannis Diamantidis </p> </div> </footer></body> </html>
