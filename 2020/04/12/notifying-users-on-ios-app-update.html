<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"><title>Notifying users when an iOS app update is available on AppStore</title><!-- Begin Jekyll SEO tag v2.8.0 --> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Notifying users when an iOS app update is available on AppStore" /> <meta name="author" content="Ioannis Diamantidis" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A post about the importance of being able to prompt users to update their app to the latest version and how to implement it on an iOS app" /> <meta property="og:description" content="A post about the importance of being able to prompt users to update their app to the latest version and how to implement it on an iOS app" /> <link rel="canonical" href="https://diamantidis.github.io/2020/04/12/notifying-users-on-ios-app-update" /> <meta property="og:url" content="https://diamantidis.github.io/2020/04/12/notifying-users-on-ios-app-update" /> <meta property="og:site_name" content="Ioannis Diamantidis" /> <meta property="og:image" content="https://diamantidis.github.io/assets/socialIcon.png" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-04-12T04:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:image" content="https://diamantidis.github.io/assets/socialIcon.png" /> <meta property="twitter:title" content="Notifying users when an iOS app update is available on AppStore" /> <meta name="twitter:site" content="@diamantidis_io" /> <meta name="twitter:creator" content="@diamantidis_io" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ioannis Diamantidis","url":"https://diamantidis.github.io"},"dateModified":"2020-04-12T04:00:00+00:00","datePublished":"2020-04-12T04:00:00+00:00","description":"A post about the importance of being able to prompt users to update their app to the latest version and how to implement it on an iOS app","headline":"Notifying users when an iOS app update is available on AppStore","image":"https://diamantidis.github.io/assets/socialIcon.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://diamantidis.github.io/2020/04/12/notifying-users-on-ios-app-update"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://diamantidis.github.io/assets/socialIcon.png"},"name":"Ioannis Diamantidis"},"url":"https://diamantidis.github.io/2020/04/12/notifying-users-on-ios-app-update"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/assets/main.css"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.png"/> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"> <link rel="manifest" href="/assets/site.webmanifest"> <link rel="mask-icon" href="assets/safari-pinned-tab.svg" color="#5bbad5"> <link rel="shortcut icon" href="/assets/favicon.ico"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/browserconfig.xml"> <meta name="theme-color" content="#ffffff"><!-- Buy me a coffee widget --> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="diamantidis" data-description="Support me on Buy me a coffee!" data-message="" data-color="#347ab7" data-position="Right" data-x_margin="18" data-y_margin="18"></script> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://diamantidis.github.io/feed.xml" title="Ioannis Diamantidis" /><script src="https://cdn.telemetrydeck.com/websdk/telemetrydeck.min.js" data-app-id='38585865-E115-4830-8D37-7A8F1213DC6B' ></script> <script> !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]); posthog.init('phc_sTVQpj2y4ME7gaB3ETrOfwqd4B78MrA2ixW11xju0Hg',{api_host:'https://eu.posthog.com'}) </script></head> <body><header class="site-header" role="banner"> <div class="wrapper"><div class="left-container"> <div class="title-wrapper"> <a class="site-title" rel="author" href="/"> <h1>Ioannis Diamantidis</h1> </a> </div> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> </div><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" /> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/tips" title="Tips">Tips</a><a class="page-link" href="/about" title="About">About</a><a class="page-link" href="/archive" title="Archive">Archive</a><a class="page-link" href="/tags" title="Tags">Tags</a></div> </nav></div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="post"> <header class="post-header"> <h1> <span class="post-title break-long-word">Notifying users when an iOS app update is available on AppStore</span> </h1> <div class="post-subheader"> <span class="post-date"> April 12, 2020 </span> <span class="post-divider">-</span> <span class="post-minutes"> 11 min read </span> <div class="outer-post-tags"> <div class="post-tags"> <a class="post-tag" href="/tags#Swift" title="Swift">Swift</a> <a class="post-tag" href="/tags#iOS" title="iOS">iOS</a> </div> </div> </div> </header> <div class="post-content"> <p>Have you ever been into a situation where you would love to see all of your users to update to the latest version of your app?</p> <p>Certain situation such as a serious crash that is fixed, the end of the support for a feature, or a breaking change on the API may make an older version of the app no longer supported, and though most of the users have the auto-update on, there is still a small but still decent percentage who has opted out.</p> <p>This situation is not the ideal to be in, but there are still things you can do and it’s better to be prepared and your app to support a functionality that will “force” the users to update to the latest version available on the App Store.</p> <p>Besides that, even if you don’t face this kind of issues, it’s always nice to remind your users that a new version is out, and that by downloading it, they will be able to enjoy all the latest features, bug fixes, better performance or whatever change may have happened in the latest version.</p> <p>So, long story short, in this post, we are going see how we can implement such a solution by fetching from iTunes some information about the latest version of the app and then use it to decide whether we should force or suggest our users to update the version of the app they are using.</p> <h2 id="solution">Solution</h2> <p>First thing first, we have to decide on the strategy we are going to follow.</p> <p>For this post, we are going to present an alert that will inform the users that they must update the version in case of a major release (the major part of the version has increased). Instead, if either the minor or patch version is increased, we are going to show an informative alert, but this time the user will have the option to dismiss it and not update the app.</p> <p>Furthermore, in both scenarios we are going to show the alert if and only if the version is released 7 days ago or more, to cater for <a href="https://help.apple.com/app-store-connect/#/dev3d65fcee1">phased roll-out</a> and also give ourselves some time to identify if there is any potential issues with the latest release and fix them before asking all our users to update the app.</p> <p>You could also wrap all this logic with some feature toggle mechanism. One such option which is also easy to integrate is <a href="https://firebase.google.com/docs/remote-config">Firebase Remote Config</a>. If you are interested to learn more, you can visit my previous posts on <a href="https://diamantidis.github.io/2019/06/22/firebase-remote-config-ab-testing">how to set it up</a> and <a href="https://diamantidis.github.io/2019/06/30/firebase-remote-config-iOS-implementation">how to add it on your iOS app</a>.</p> <h2 id="implementation">Implementation</h2> <p>Let’s start with where we can fetch the information about the latest release from iTunes. There is a URL in the format <code class="language-plaintext highlighter-rouge">http://itunes.apple.com/lookup?bundleId={bundleId}</code>, where <code class="language-plaintext highlighter-rouge">{bundleId}</code> is the Bundle Identifier of your app. The result of this URL is a file with a JSON object which amongst other contains information like the current version of the app, the date of the last release, the release notes, etc.</p> <p>So, the first thing that we are going to do in the app is to implement the corresponding models to decode this information. We are going to introduce 3 models: <code class="language-plaintext highlighter-rouge">iTunesInfo</code> which represent the external JSON object, <code class="language-plaintext highlighter-rouge">AppInfo</code> which represents the information about the app, like the version and date of the current release and lastly, <code class="language-plaintext highlighter-rouge">Version</code> which represent the version of the app in three <code class="language-plaintext highlighter-rouge">Int</code> properties, major, minor and patch.</p> <p>The following snippet contains the implementation for all these 3 models:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">struct</span> <span class="nv">iTunesInfo</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">AppInfo</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">AppInfo</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">version</span><span class="p">:</span> <span class="kt">Version</span>
    <span class="k">var</span> <span class="nv">currentVersionReleaseDate</span><span class="p">:</span> <span class="kt">Date</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Version</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
    <span class="c1">// MARK: - Enumerations</span>
    <span class="kd">enum</span> <span class="kt">VersionError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">invalidFormat</span>
    <span class="p">}</span>

    <span class="c1">// MARK: - Public properties</span>
    <span class="k">let</span> <span class="nv">major</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">minor</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">patch</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="c1">// MARK: - Initializers</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">singleValueContainer</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">version</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
            <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">version</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">VersionError</span><span class="o">.</span><span class="n">invalidFormat</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">version</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">versionComponents</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="s">"."</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">Int</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="n">versionComponents</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">VersionError</span><span class="o">.</span><span class="n">invalidFormat</span>
        <span class="p">}</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">major</span> <span class="o">=</span> <span class="n">versionComponents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">let</span> <span class="nv">minor</span> <span class="o">=</span> <span class="n">versionComponents</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="k">let</span> <span class="nv">patch</span> <span class="o">=</span> <span class="n">versionComponents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">VersionError</span><span class="o">.</span><span class="n">invalidFormat</span>
        <span class="p">}</span>

        <span class="k">self</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">major</span>
        <span class="k">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">=</span> <span class="n">minor</span>
        <span class="k">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Then, let’s move on to the implementation of the <code class="language-plaintext highlighter-rouge">AppUpdateManager</code>, which will be responsible about the decision of whether we will prompt the users to update the app, and what time of update is it (required or optional). The implementation will be like the snippet below:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">class</span> <span class="kt">AppUpdateManager</span> <span class="p">{</span>

    <span class="c1">// MARK: - Enumerations</span>
    <span class="kd">enum</span> <span class="kt">Status</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kd">required</span>
        <span class="k">case</span> <span class="kd">optional</span>
        <span class="k">case</span> <span class="n">noUpdate</span>
    <span class="p">}</span>

    <span class="c1">// MARK: - Initializers</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">bundle</span><span class="p">:</span> <span class="kt">BundleType</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bundle</span> <span class="o">=</span> <span class="n">bundle</span>
    <span class="p">}</span>

    <span class="c1">// MARK: - Public methods</span>
    <span class="kd">func</span> <span class="nf">updateStatus</span><span class="p">(</span><span class="k">for</span> <span class="nv">bundleId</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Status</span> <span class="p">{</span>

        <span class="c1">// Get the version of the app</span>
        <span class="k">let</span> <span class="nv">appVersionKey</span> <span class="o">=</span> <span class="s">"CFBundleShortVersionString"</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">appVersionValue</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forInfoDictionaryKey</span><span class="p">:</span> <span class="n">appVersionKey</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">String</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">noUpdate</span>
        <span class="p">}</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">appVersion</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">Version</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">appVersionValue</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">noUpdate</span>
        <span class="p">}</span>

        <span class="c1">// Get app info from App Store</span>
        <span class="k">let</span> <span class="nv">iTunesURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://itunes.apple.com/lookup?bundleId=</span><span class="se">\(</span><span class="n">bundleId</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">iTunesURL</span><span class="p">,</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="kt">NSData</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">noUpdate</span>
        <span class="p">}</span>

        <span class="c1">// Decode the response</span>
        <span class="k">let</span> <span class="nv">decoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
        <span class="n">decoder</span><span class="o">.</span><span class="n">dateDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="n">iso8601</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">iTunesInfo</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">data</span> <span class="k">as</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">noUpdate</span>
        <span class="p">}</span>

        <span class="c1">// Verify that there is at least on result in the response</span>
        <span class="k">guard</span> <span class="n">response</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="k">let</span> <span class="nv">appInfo</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">first</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">noUpdate</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">appStoreVersion</span> <span class="o">=</span> <span class="n">appInfo</span><span class="o">.</span><span class="n">version</span>
        <span class="k">let</span> <span class="nv">releaseDate</span> <span class="o">=</span> <span class="n">appInfo</span><span class="o">.</span><span class="n">currentVersionReleaseDate</span>

        <span class="k">let</span> <span class="nv">oneWeekInSeconds</span><span class="p">:</span> <span class="kt">TimeInterval</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="k">let</span> <span class="nv">dateOneWeekAgo</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">(</span><span class="nv">timeIntervalSinceNow</span><span class="p">:</span> <span class="o">-</span><span class="n">oneWeekInSeconds</span><span class="p">)</span>

        <span class="c1">// Decide if it's a required or optional update based on the release date and the version change</span>
        <span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="n">orderedAscending</span> <span class="o">=</span> <span class="n">releaseDate</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">dateOneWeekAgo</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">appStoreVersion</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="n">appVersion</span><span class="o">.</span><span class="n">major</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">.</span><span class="kd">required</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">appStoreVersion</span><span class="o">.</span><span class="n">minor</span> <span class="o">&gt;</span> <span class="n">appVersion</span><span class="o">.</span><span class="n">minor</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">.</span><span class="kd">optional</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">appStoreVersion</span><span class="o">.</span><span class="n">patch</span> <span class="o">&gt;</span> <span class="n">appVersion</span><span class="o">.</span><span class="n">patch</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">.</span><span class="kd">optional</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="o">.</span><span class="n">noUpdate</span>
    <span class="p">}</span>

    <span class="c1">// MARK: - Private properties</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">bundle</span><span class="p">:</span> <span class="kt">BundleType</span>
<span class="p">}</span>
</code></pre></div></div> <p>Firstly, we define an enumeration which represent the 3 different options regarding the update; it could be <code class="language-plaintext highlighter-rouge">required</code>, <code class="language-plaintext highlighter-rouge">optional</code>, or there is no need to update right now.</p> <p>Then, we provide an initializer which is used to inject the dependency. We need to fetch the version of the running app, and instead of directly using the <code class="language-plaintext highlighter-rouge">Bundle.main</code>, we inject a property which conforms to the protocol <code class="language-plaintext highlighter-rouge">BundleType</code>. In this way, we could later provide a mock implementation and write some unit tests.</p> <p>The following snippet contains the definition of <code class="language-plaintext highlighter-rouge">BundleType</code> as well the conformance of <code class="language-plaintext highlighter-rouge">Bundle</code> to it:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">BundleType</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">object</span><span class="p">(</span><span class="n">forInfoDictionaryKey</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Any</span><span class="p">?</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Bundle</span><span class="p">:</span> <span class="kt">BundleType</span> <span class="p">{}</span>
</code></pre></div></div> <p>Going back to the <code class="language-plaintext highlighter-rouge">AppUpdateManager</code> class, we have the <code class="language-plaintext highlighter-rouge">updateStatus</code> method. In its body, we start by getting the version of the running app. Then, we fetch the app info from iTunes using the URL we mentioned before and decode the response. As we move on, we are calculating what was the day one week ago.</p> <p>Last, using the release date, the version we fetched from iTunes, the day one week ago and the version of the app that’s running, we implement the logic of our strategy and return the corresponding status.</p> <p>And that’s about the <code class="language-plaintext highlighter-rouge">AppUpdateManager</code>. Before we see how we can use it, we have to decide on how we are going to present this information to the user. For this reason, we are going to need two extensions.</p> <p>The first one will be responsible for opening the AppStore page for the app so that the users can update the app. We are going to add it as an extension to <code class="language-plaintext highlighter-rouge">UIApplication</code> and its implementation is in the following snippet:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">UIApplication</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">openAppStore</span><span class="p">(</span><span class="k">for</span> <span class="nv">appID</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">appStoreURL</span> <span class="o">=</span> <span class="s">"https://itunes.apple.com/app/</span><span class="se">\(</span><span class="n">appID</span><span class="se">)</span><span class="s">"</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">appStoreURL</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="nf">canOpenURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="nf">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>The second one, will be responsible of creating a <code class="language-plaintext highlighter-rouge">UIAlertController</code> based on the value returned from the <code class="language-plaintext highlighter-rouge">updateStatus</code> method. For this reason, we are going to provide a convenience initializer to the <code class="language-plaintext highlighter-rouge">UIAlertController</code> and in the snippet below you can find the implementation:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">UIAlertController</span> <span class="p">{</span>
    <span class="kd">convenience</span> <span class="nf">init</span><span class="p">?(</span><span class="k">for</span> <span class="nv">status</span><span class="p">:</span> <span class="kt">AppUpdateManager</span><span class="o">.</span><span class="kt">Status</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="n">noUpdate</span> <span class="o">=</span> <span class="n">status</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>

        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"App Update"</span>

        <span class="k">let</span> <span class="nv">updateNowAction</span> <span class="o">=</span> <span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Update now"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">appId</span> <span class="o">=</span> <span class="s">"idXXXXXXXXXX"</span> <span class="c1">// Replace with your appId</span>
            <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">openAppStore</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">appId</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">self</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">updateNowAction</span><span class="p">)</span>

        <span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="kd">required</span> <span class="o">=</span> <span class="n">status</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s">"You have to update the app."</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">case</span> <span class="o">.</span><span class="kd">optional</span> <span class="o">=</span> <span class="n">status</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s">"There is a new version of the app."</span>
            <span class="k">let</span> <span class="nv">cancelAction</span> <span class="o">=</span> <span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Not now"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">cancelAction</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now, with everything set up, we can move to one <code class="language-plaintext highlighter-rouge">UIViewController</code> and add the following snippet, to present the alert if an update is available on AppStore:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">bundleId</span> <span class="o">=</span> <span class="s">"com.example.yourapp"</span>
<span class="k">let</span> <span class="nv">appUpdater</span> <span class="o">=</span> <span class="kt">AppUpdateManager</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">updateStatus</span> <span class="o">=</span> <span class="n">appUpdater</span><span class="o">.</span><span class="nf">updateStatus</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">bundleId</span><span class="p">)</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">alertController</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">updateStatus</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">alertController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <blockquote> <p>If your app is not yet available on the App Store, you can use the bundleID of another app. Here is <a href="https://support.apple.com/guide/mdm/ios-and-ipados-bundle-ids-mdm90f60c1ce/web">a list of the bundleID of Apple’s apps</a>.</p> </blockquote> <p>All these snippets as well as the implementation of some unit tests can be found on GitHub in this <a href="https://gist.github.com/diamantidis/fa7a5d4dce336e5b8f83827cb229fa9c">gist</a>.</p> <h2 id="result">Result</h2> <p>The outcome of this implementation will look like the following screenshots depending on the AppStore’s and your app’s version:</p> <p><img src="https://diamantidis.github.io/assets/app_updates/optional_update.png" alt="Optional Update alert screenshot" />   <img src="https://diamantidis.github.io/assets/app_updates/required_update.png" alt="Required Update alert screenshot" /></p> <p>Of course, in your app you could use a different UI component to present the information and maybe follow a different strategy and define your own set of rules on whether the app should present the update prompt or not.</p> <blockquote> <p>FYI, there is an open-source project named <a href="https://github.com/ArtSabintsev/Siren">Siren</a> which you could alternatively use.</p> </blockquote> <p>As a side note, it seems that Android already offers a solution for <a href="https://developer.android.com/guide/playcore/in-app-updates">in-app-updates</a>, so hopefully, I can see it coming on iOS soon, and then we will not have to force the users to open AppStore to make the update.</p> <h2 id="conclusion">Conclusion</h2> <p>And that’s about it! In this post, we have seen how we can notify the users of an iOS app when a new update is available on the AppStore. First we have seen why it important to act proactively and support such a feature so that it is available by the time we need it and then we have walked through the steps needed to develop such a solution.</p> <p>I hope that by adding this feature in your app more and more users will move to the latest version.</p> <p>Thanks for reading this post, I hope you find it useful! Feel free to follow me on <a href="https://twitter.com/diamantidis_io">Twitter</a> and share your comments about this post!</p> </div> <div class="socials"> <!-- Buy me a coffee button --> <a href="https://www.buymeacoffee.com/diamantidis" target="_blank"> <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" > </a> <div class="share"> <strong>Share: </strong> <a href="//twitter.com/share?text=Notifying+users+when+an+iOS+app+update+is+available+on+AppStore&url=https%3A%2F%2Fdiamantidis.github.io%2F2020%2F04%2F12%2Fnotifying-users-on-ios-app-update" aria-label="Share on Twitter" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.facebook.com/sharer.php?t=Notifying+users+when+an+iOS+app+update+is+available+on+AppStore&u=https%3A%2F%2Fdiamantidis.github.io%2F2020%2F04%2F12%2Fnotifying-users-on-ios-app-update" aria-label="Share on Facebook" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdiamantidis.github.io%2F2020%2F04%2F12%2Fnotifying-users-on-ios-app-update" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </div></article> </div> </main><footer class="site-footer"> <data class="u-url" href="/"></data> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> <div class="wrapper"> <p>Built with <i class="fa fa-heart" aria-hidden="true"></i>, <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/"> Github Pages</a> </p> <p> © Copyright 2024 Ioannis Diamantidis </p> </div> </footer></body> </html>
