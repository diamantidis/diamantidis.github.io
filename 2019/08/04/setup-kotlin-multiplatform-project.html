<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"><title>How to setup a Kotlin Multiplatform Project for iOS and Android</title><!-- Begin Jekyll SEO tag v2.8.0 --> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="How to setup a Kotlin Multiplatform Project for iOS and Android" /> <meta name="author" content="Ioannis Diamantidis" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A step-by-step guide on how to create a new project for iOS and Android with Kotlin Multiplatform Project" /> <meta property="og:description" content="A step-by-step guide on how to create a new project for iOS and Android with Kotlin Multiplatform Project" /> <link rel="canonical" href="https://diamantidis.github.io/2019/08/04/setup-kotlin-multiplatform-project" /> <meta property="og:url" content="https://diamantidis.github.io/2019/08/04/setup-kotlin-multiplatform-project" /> <meta property="og:site_name" content="Ioannis Diamantidis" /> <meta property="og:image" content="https://diamantidis.github.io/assets/socialIcon.png" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-08-04T06:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:image" content="https://diamantidis.github.io/assets/socialIcon.png" /> <meta property="twitter:title" content="How to setup a Kotlin Multiplatform Project for iOS and Android" /> <meta name="twitter:site" content="@diamantidis_io" /> <meta name="twitter:creator" content="@diamantidis_io" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ioannis Diamantidis","url":"https://diamantidis.github.io"},"dateModified":"2019-08-04T06:00:00+00:00","datePublished":"2019-08-04T06:00:00+00:00","description":"A step-by-step guide on how to create a new project for iOS and Android with Kotlin Multiplatform Project","headline":"How to setup a Kotlin Multiplatform Project for iOS and Android","image":"https://diamantidis.github.io/assets/socialIcon.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://diamantidis.github.io/2019/08/04/setup-kotlin-multiplatform-project"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://diamantidis.github.io/assets/socialIcon.png"},"name":"Ioannis Diamantidis"},"url":"https://diamantidis.github.io/2019/08/04/setup-kotlin-multiplatform-project"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/assets/main.css"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.png"/> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"> <link rel="manifest" href="/assets/site.webmanifest"> <link rel="mask-icon" href="assets/safari-pinned-tab.svg" color="#5bbad5"> <link rel="shortcut icon" href="/assets/favicon.ico"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/browserconfig.xml"> <meta name="theme-color" content="#ffffff"><!-- Buy me a coffee widget --> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="diamantidis" data-description="Support me on Buy me a coffee!" data-message="" data-color="#347ab7" data-position="Right" data-x_margin="18" data-y_margin="18"></script> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://diamantidis.github.io/feed.xml" title="Ioannis Diamantidis" /><script src="https://cdn.telemetrydeck.com/websdk/telemetrydeck.min.js" data-app-id='38585865-E115-4830-8D37-7A8F1213DC6B' ></script> <script> !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]); posthog.init('phc_sTVQpj2y4ME7gaB3ETrOfwqd4B78MrA2ixW11xju0Hg',{api_host:'https://eu.posthog.com'}) </script></head> <body><header class="site-header" role="banner"> <div class="wrapper"><div class="left-container"> <div class="title-wrapper"> <a class="site-title" rel="author" href="/"> <h1>Ioannis Diamantidis</h1> </a> </div> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-sm"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> </div><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" /> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/tips" title="Tips">Tips</a><a class="page-link" href="/about" title="About">About</a><a class="page-link" href="/archive" title="Archive">Archive</a><a class="page-link" href="/tags" title="Tags">Tags</a></div> </nav></div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="post"> <header class="post-header"> <h1> <span class="post-title break-long-word">How to setup a Kotlin Multiplatform Project for iOS and Android</span> </h1> <div class="post-subheader"> <span class="post-date"> August 4, 2019 </span> <span class="post-divider">-</span> <span class="post-minutes"> 5 min read </span> <div class="outer-post-tags"> <div class="post-tags"> <a class="post-tag" href="/tags#iOS" title="iOS">iOS</a> <a class="post-tag" href="/tags#Xcode" title="Xcode">Xcode</a> <a class="post-tag" href="/tags#IntelliJ" title="IntelliJ">IntelliJ</a> <a class="post-tag" href="/tags#Android" title="Android">Android</a> <a class="post-tag" href="/tags#Kotlin" title="Kotlin">Kotlin</a> <a class="post-tag" href="/tags#Kotlin+Native" title="Kotlin Native">Kotlin Native</a> </div> </div> </div> </header> <div class="post-content"> <p>Hi, time has come to write something about Kotlin Multiplatform Project and more specifically how to setup a project with an iOS app, an Android app and a shared library. I have recently started playing around with Kotlin Multiplatform Project, and it seems quite an interesting project to me. Thus, I will try to document my steps and learning in a series of posts, starting from this one.</p> <p>Kotlin Multiplatform Project(or KMP from now on) is an experimental feature that allows us to write code in Kotlin and compile/transpile this codebase to multiple platforms including JVM, Android, iOS, Javascript, Desktop apps, etc.</p> <p>Thanks to <a href="https://kotlinlang.org/docs/reference/native-overview.html">Kotlin native</a>(or K/N), we are able to compile Kotlin code to native binaries, including but not restricted to iOS, meaning that we can write some code in Kotlin which can be used on both the iOS and Android app. Doesn’t it sound interesting?</p> <p>Quite often while developing an app, we end up in scenarios where we have to write a lot of duplicate or similar code between the iOS and Android app. Usually, it’s related to network requests, the transformation of the data fetched so that they can populate views and/or something else. Generally, it’s the so-called business logic.</p> <p>And that is the problem that KMP is there to solve. Write this business logic once and share in with multiple targets. And despite the fact that I am focusing more on sharing code between iOS and Android, it doesn’t mean that you are limited to this. In contrast, you can share code between Server and Client, iOS, Android, Javascript, Desktop (macOS, windows, linux), webassembly etc.</p> <p>Be aware, though, that KMP is still an experimental feature and as per <a href="https://kotlinlang.org/docs/reference/building-mpp-with-gradle.html">Kotlin Reference Page</a></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Multiplatform projects are an experimental feature in Kotlin 1.2 and 1.3. 
All of the language and tooling features described in this document are subject to change in future Kotlin versions.
</code></pre></div></div> <p>So, be careful and think twice before taking the decision to use it on a real project.</p> <p>Let’s try to create our first project!!</p> <h2 id="how-to-create-a-project-with-intellij">How to create a project with IntelliJ</h2> <p>For this tutorial, I am using IntelliJ IDEA CE 2019.1.3 to create the initial project, Android Studio 3.4.2 and Xcode 10.2.1. Apart from those, I am using Kotlin 1.3.41 and Gradle 5.4.1</p> <p>To create the initial project:</p> <ol> <li>Head to IntelliJ and create a new project.</li> <li>From the option on the left pane, select <code class="language-plaintext highlighter-rouge">Kotlin</code>, then <code class="language-plaintext highlighter-rouge">Mobile Android/iOS | Gradle</code> from the main pane and press <code class="language-plaintext highlighter-rouge">Next</code></li> <li>In the next screen, make sure to have checked the <code class="language-plaintext highlighter-rouge">Use default Gradle wrapper</code> and press <code class="language-plaintext highlighter-rouge">Next</code></li> <li>Then choose a name for your project and press <code class="language-plaintext highlighter-rouge">Next</code>.</li> </ol> <p><img src="https://diamantidis.github.io/assets/kmp/intellij_kmp_project.png" alt="IntelliJ KMP projects screenshot" /></p> <p>The project is created and it will try to sync Gradle and build. But it will fail with an error saying</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The SDK directory '&lt;projectDir&gt;/PleaseSpecifyAndroidSdkPathHere' does not exist.

Please fix the 'sdk.dir' property in the local.properties file.
</code></pre></div></div> <p>To fix this issue, edit <code class="language-plaintext highlighter-rouge">local.properties</code> which is located on the root directory of the project and add the SDK path (usually located at <code class="language-plaintext highlighter-rouge">/Users/&lt;user&gt;/Library/Android/sdk</code>)</p> <p>Now, you can head to Android Studio and run the Android app!! If everything is correct, the app will be built successfully and you will see a screen with a message <code class="language-plaintext highlighter-rouge">Hello from Android</code>.</p> <p>Time to try the iOS app. Let’s open the <code class="language-plaintext highlighter-rouge">iosApp.xcodeproj</code> with Xcode and try to build the app on a Simulator.</p> <p>It will fail with an error:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
.
.
/../gradlew: No such file or directory
Command PhaseScriptExecution failed with a nonzero exit code
</code></pre></div></div> <p>To fix this issue, run <code class="language-plaintext highlighter-rouge">gradle wrapper</code> on the project root directory, wait until it is finished and then try to build the app again. You should be able to run the app and you will see a screen with a message <code class="language-plaintext highlighter-rouge">Hello from iOS</code>.</p> <p><img src="https://diamantidis.github.io/assets/kmp/android_app.png" alt="Android app screenshot" /> <img src="https://diamantidis.github.io/assets/kmp/ios_app.png" alt="iOS app screenshot" /></p> <p>But, we are not done yet. To run the app on a real iOS device, the app should be signed. Therefore, if you try to run the project on a real iOS device, you will get a error with message: <code class="language-plaintext highlighter-rouge">Signing for "iosApp" requires a development team. Select a development team in the project editor. (in target 'iosApp')</code></p> <p>To fix this, go to the project Editor and change the Bundle Identifier and select your Personal Team for the signing.</p> <p><img src="https://diamantidis.github.io/assets/kmp/xcode_signing.png" alt="Xcode project signing screenshot" /></p> <p>After applying this fix, when you try to build the app again, a new error will appear, with a message:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Undefined symbols for architecture arm64:
  "_OBJC_CLASS_$_AppProxy", referenced from:
      objc-class-ref in ViewController.o
ld: symbol(s) not found for architecture arm64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
</code></pre></div></div> <p>The root cause of this issue, can be easily found if you navigate to <code class="language-plaintext highlighter-rouge">app/build.gradle</code>. Inside the <code class="language-plaintext highlighter-rouge">kotlin</code> block, you will notice a comment like <code class="language-plaintext highlighter-rouge">Switch here to iosArm64 (or iosArm32) to build library for iPhone device</code>.</p> <p><img src="https://diamantidis.github.io/assets/kmp/ios_project_block.png" alt="iOS project block screenshot" /></p> <p>The existing code is suitable only for the simulator, so if you want to run on an actual device, you have to change <code class="language-plaintext highlighter-rouge">iosX64</code> to <code class="language-plaintext highlighter-rouge">iosArm64</code>. Ideally, we would like to be able to run the app, both on Simulator and on an actual device without having to change that every time.</p> <p>To do that, remove the whole <code class="language-plaintext highlighter-rouge">iosX64("ios")</code> block and instead put the following script:</p> <div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">targets</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">def</span> <span class="n">iOSTarget</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s1">'SDK_NAME'</span><span class="o">)?.</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">"iphoneos"</span><span class="o">)</span> <span class="err">\</span>
                          <span class="o">?</span> <span class="n">presets</span><span class="o">.</span><span class="na">iosArm64</span> <span class="o">:</span> <span class="n">presets</span><span class="o">.</span><span class="na">iosX64</span>

    <span class="n">fromPreset</span><span class="o">(</span><span class="n">iOSTarget</span><span class="o">,</span> <span class="s1">'ios'</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">binaries</span> <span class="o">{</span>
            <span class="n">framework</span><span class="o">()</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Now, try to build the app again. This time, the iOS app will be successfully built both on actual devices and simulators!!!</p> <h2 id="conclusion">Conclusion</h2> <p>And this is it!! If you are interested, you can find this project on <a href="https://github.com/diamantidis/KMP_base">GitHub</a>. This project, which is created by following these steps, will act as the base for my next posts on KMP. In the next post, I will try to delve deeper on the structure on the initial project and make some tweaks here and there. See you soon!!</p> </div> <div class="socials"> <!-- Buy me a coffee button --> <a href="https://www.buymeacoffee.com/diamantidis" target="_blank"> <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" > </a> <div class="share"> <strong>Share: </strong> <a href="//twitter.com/share?text=How+to+setup+a+Kotlin+Multiplatform+Project+for+iOS+and+Android&url=https%3A%2F%2Fdiamantidis.github.io%2F2019%2F08%2F04%2Fsetup-kotlin-multiplatform-project" aria-label="Share on Twitter" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.facebook.com/sharer.php?t=How+to+setup+a+Kotlin+Multiplatform+Project+for+iOS+and+Android&u=https%3A%2F%2Fdiamantidis.github.io%2F2019%2F08%2F04%2Fsetup-kotlin-multiplatform-project" aria-label="Share on Facebook" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </span> </a> <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdiamantidis.github.io%2F2019%2F08%2F04%2Fsetup-kotlin-multiplatform-project" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </div></article> </div> </main><footer class="site-footer"> <data class="u-url" href="/"></data> <div class="footer-icons"> <ul> <li> <div class="social-icon"> <a href="https://twitter.com/diamantidis_io" aria-label="Twitter"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://github.com/diamantidis" aria-label="GitHub"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="http://linkedin.com/in/ioannis-diamantidis" aria-label="LinkedIn"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="https://instagram.com/diama.codes" aria-label="Instagram"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-instagram fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="/feed.xml" aria-label="RSS Feed"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> <li> <div class="social-icon"> <a href="mailto:diamantidis@outlook.com" aria-label="Email"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </div> </li> </ul> </div> <div class="wrapper"> <p>Built with <i class="fa fa-heart" aria-hidden="true"></i>, <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/"> Github Pages</a> </p> <p> © Copyright 2024 Ioannis Diamantidis </p> </div> </footer></body> </html>
